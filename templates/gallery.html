{% extends "base.html" %}
{% block content %}
<!-- Gallery Hero Section -->
<section class="gallery-page-header">
    <div class="gallery-hero">
        <div class="hero-icon">üñºÔ∏è</div>
        <h1>‡§ó‡•à‡§≤‡§∞‡•Ä</h1>
        <p class="gallery-subtitle">‡§Æ‡§π‡§æ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§≤‡§Ø ‡§ï‡•Ä ‡§Ø‡§æ‡§¶‡§ó‡§æ‡§∞ ‡§™‡§≤‡•ã‡§Ç ‡§ï‡•Ä ‡§ù‡§≤‡§ï</p>
    </div>
</section>

<!-- Gallery Section -->
<section class="gallery-section">
    <div class="gallery-container">
        {% if gallery %}
            {% for image_item in gallery %}
            <div class="gallery-item" data-gallery-id="{{ image_item.id }}">
                <div class="gallery-image-wrapper">
                    <img src="{{ url_for('static', filename=image_item.photo) }}" alt="{{ image_item.title }}" loading="lazy">
                    <div class="gallery-overlay">
                        <div class="gallery-overlay-content">
                            <h3>{{ image_item.title }}</h3>
                            <p>{{ image_item.description }}</p>
                            <button class="view-image-btn" onclick="openLightbox({{ loop.index0 }})">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                                View Image
                            </button>
                        </div>
                    </div>
                </div>
                <div class="gallery-content">
                    <h2>{{ image_item.title }}</h2>
                    <p>{{ image_item.description }}</p>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="empty-gallery-state">
                <svg width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    <circle cx="8.5" cy="8.5" r="1.5"></circle>
                    <polyline points="21 15 16 10 5 21"></polyline>
                </svg>
                <h3>‡§ó‡•à‡§≤‡§∞‡•Ä ‡§ñ‡§æ‡§≤‡•Ä ‡§π‡•à</h3>
                <p>‡§´‡§ø‡§≤‡§π‡§æ‡§≤ ‡§ï‡•ã‡§à ‡§õ‡§µ‡§ø‡§Ø‡§æ‡§Ç ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡§Ç‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§¨‡§æ‡§¶ ‡§Æ‡•á‡§Ç ‡§¶‡•á‡§ñ‡•á‡§Ç‡•§</p>
            </div>
        {% endif %}
    </div>
</section>

<!-- Lightbox Modal -->
<div id="lightbox-modal" class="lightbox-modal">
    <span class="lightbox-close">&times;</span>
    <div class="lightbox-content">
        <img id="lightbox-image" src="" alt="Gallery Image">
        <div class="lightbox-info">
            <h3 id="lightbox-title"></h3>
            <p id="lightbox-description"></p>
        </div>
    </div>
    <button class="lightbox-prev" onclick="changeImage(-1)">&#10094;</button>
    <button class="lightbox-next" onclick="changeImage(1)">&#10095;</button>
</div>

<script>
let currentImageIndex = 0;
const galleryItems = [
    {% if gallery %}
    {% for image_item in gallery %}
    {
        id: {{ image_item.id }},
        title: {{ image_item.title | tojson }},
        description: {{ image_item.description | tojson }},
        photo: {{ image_item.photo | tojson }}
    }{% if not loop.last %},{% endif %}
    {% endfor %}
    {% endif %}
];

// Image lazy loading
document.addEventListener('DOMContentLoaded', function() {
    const images = document.querySelectorAll('.gallery-image-wrapper img');
    images.forEach(img => {
        img.addEventListener('load', function() {
            this.classList.add('loaded');
        });
        // Trigger load if already cached
        if (img.complete) {
            img.classList.add('loaded');
        }
    });
});

function openLightbox(index) {
    if (!galleryItems || galleryItems.length === 0) return;
    
    currentImageIndex = index;
    const item = galleryItems[index];
    if (item) {
        const lightboxImage = document.getElementById('lightbox-image');
        const lightboxTitle = document.getElementById('lightbox-title');
        const lightboxDescription = document.getElementById('lightbox-description');
        const lightboxModal = document.getElementById('lightbox-modal');
        
        lightboxImage.src = `/static/${item.photo}`;
        lightboxTitle.textContent = item.title || 'Gallery Image';
        lightboxDescription.textContent = item.description || 'No description available';
        lightboxModal.style.display = 'flex';
        lightboxModal.classList.add('active');
        document.body.style.overflow = 'hidden';
    }
}

function closeLightbox() {
    const lightboxModal = document.getElementById('lightbox-modal');
    lightboxModal.style.display = 'none';
    lightboxModal.classList.remove('active');
    document.body.style.overflow = 'auto';
}

function changeImage(direction) {
    if (!galleryItems || galleryItems.length === 0) return;
    
    currentImageIndex += direction;
    if (currentImageIndex < 0) currentImageIndex = galleryItems.length - 1;
    if (currentImageIndex >= galleryItems.length) currentImageIndex = 0;
    openLightbox(currentImageIndex);
}

// Initialize event listeners when DOM is ready
document.addEventListener('DOMContentLoaded', function() {
    const lightboxModal = document.getElementById('lightbox-modal');
    const lightboxClose = document.querySelector('.lightbox-close');
    
    if (lightboxModal) {
        // Close on click outside
        lightboxModal.addEventListener('click', function(e) {
            if (e.target === this) closeLightbox();
        });
    }
    
    if (lightboxClose) {
        // Close button
        lightboxClose.addEventListener('click', closeLightbox);
    }
    
    // Close on escape key and arrow navigation
    document.addEventListener('keydown', function(e) {
        if (lightboxModal && lightboxModal.style.display === 'flex') {
            if (e.key === 'Escape') {
                closeLightbox();
            } else if (e.key === 'ArrowLeft') {
                changeImage(-1);
            } else if (e.key === 'ArrowRight') {
                changeImage(1);
            }
        }
    });
});
</script>
{% endblock %}